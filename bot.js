const TelegramBot = require('node-telegram-bot-api');const token = '6546890157:AAGqjhIHJRZjpfW0gA2OcnLwF0bqsSe9g0o';const bot = new TelegramBot(token, {polling: true});const links = require('./db/links.json');const fs = require('fs');const startParser = require('./startParser');bot.onText(/\/start/, (msg) => {  const chatId = msg.chat.id;  bot.sendMessage(chatId, "➡️ Для добавления введи команду в формате /add ссылка кешбекОт ценаДо\n➡️ Для удаления введи команду в формате /del НОМЕР", {    "reply_markup": {      "keyboard": [["Список ссылок"]],      "resize_keyboard": true,    }  });});bot.onText(/\/del (.+)/, (msg, match) => {  let chatId = msg.chat.id;  match[1] = Number(match[1]);  let link = links[match[1]].link;  links.splice(match[1], 1);  fs.writeFile("./db/links.json", JSON.stringify(links), (err) => console.log(err));  bot.sendMessage(chatId, "Ссылка [" + link + "] удалена!");});bot.onText(/\/add (.+) (.+)/, (msg, match) => {  console.log(msg.text.split(' ').length);  if (msg.text.split(' ').length >= 4) return;  const chatId = msg.chat.id;  const resp = match[1];  if (!resp) return bot.sendMessage(chatId, "Введите ссылку");  if (links.find(item => item.link === resp)) return bot.sendMessage(chatId, "Ссылка уже добавлена");  links.push({    link: resp,    cashback: match[2]  });  fs.writeFile("./db/links.json", JSON.stringify(links), (err) => console.log(err));  bot.sendMessage(chatId, "Ссылка [" + resp + "] добавлена!");});// Matches "/echo [whatever]"bot.onText(/\/add (.+) (.+) (.+)/, (msg, match) => {  if (!match[3]) return;  const chatId = msg.chat.id;  const resp = match[1];  if (!resp) return bot.sendMessage(chatId, "Введите ссылку");  if (links.find(item => item.link === resp)) return bot.sendMessage(chatId, "Ссылка уже добавлена");  links.push({    link: resp,    cashback: match[3],    price: match[2]  });  fs.writeFile("./db/links.json", JSON.stringify(links), (err) => console.log(err));  bot.sendMessage(chatId, "Ссылка [" + resp + "] добавлена!");});bot.onText(/Список ссылок/, (msg) => {  try {    const chatId = msg.chat.id;    let message = '';    links.forEach((item, index) => {      message += index + '. ' + item.link + ' [' + item.price + "|" + item.cashback + ']' + '\n'    });    bot.sendMessage(chatId, 'Список ссылок в формате "ссылка [цена|кешбек]": \n' + message, {      disable_web_page_preview: true    });    if (!message) return bot.sendMessage(chatId, "Список ссылок пуст");  } catch (e) {    console.log(e);  }});startParser(bot);